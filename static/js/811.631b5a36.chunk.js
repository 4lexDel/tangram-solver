(()=>{"use strict";class e{cloneNDArray(e){return function e(t){return Array.isArray(t)?t.map(e):t}(e)}areArraysEqual(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){if(e[r].length!==t[r].length)return!1;for(let l=0;l<e[r].length;l++)if(e[r][l]!==t[r][l])return!1}return!0}rotate2DArray(e){const t=e.length,r=e[0].length,l=[];for(let s=0;s<r;s++){const r=[];for(let l=0;l<t;l++)r.push(e[l][s]);l.push(r)}const n=[];for(let s=0;s<r;s++){const e=l[s].reverse();n.push(e)}return n}reverse2DArray(e){const t=e.length,r=e[0].length,l=[];for(let n=0;n<t;n++){const t=[];for(let l=r-1;l>=0;l--)t.push(e[n][l]);l.push(t)}return l}cropMatrix(e){let t=e[0].length,r=0,l=e.length,n=0;for(let a=0;a<e.length;a++)for(let s=0;s<e[a].length;s++)!1!==e[a][s]&&(t=Math.min(t,s),r=Math.max(r,s),l=Math.min(l,a),n=Math.max(n,a));let s=[];for(let a=l;a<=n;a++){let l=[];for(let n=t;n<=r;n++)l.push(e[a][n]);s.push(l)}return s}getCropAreas(e){e=this.cloneNDArray(e);let t=[],r=100;for(;;){let l=this.countBlocksInNextAreaAvailable(e,r);if(!l)break;let{count:n,pattern:s}=l,a=this.cropMatrixByValue(s,r);t.push({area:a,count:n}),r+=100}return t}countBlocksInNextAreaAvailable(e,t){let r=this.getFirstBlockCoordAvailable(e);if(!r)return null;let l={val:1,currentId:t};return e[r.x][r.y]=t,this.countAreaBlocks(e,r,l),{count:l.val,pattern:e}}getFirstBlockCoordAvailable(e){for(let t=0;t<e.length;t++)for(let r=0;r<e[0].length;r++)if(0==e[t][r])return{x:t,y:r};return null}countAreaBlocks(e,t,r){let l=this.getNeighboorsAvailable(e,t);l.forEach((t=>{r.val++,e[t.x][t.y]=r.currentId})),l.forEach((t=>{this.countAreaBlocks(e,t,r)}))}getNeighboorsAvailable(e,t){let r=[];return[[0,-1],[-1,0],[1,0],[0,1]].forEach((l=>{l[0]+=t.x,l[1]+=t.y,l[0]>=0&&l[0]<e.length&&l[1]>=0&&l[1]<e[0].length&&0==e[l[0]][l[1]]&&r.push({x:l[0],y:l[1]})})),r}cropMatrixByValue(e,t){let r=e[0].length,l=0,n=e.length,s=0;for(let h=0;h<e.length;h++)for(let a=0;a<e[h].length;a++)e[h][a]==t&&(r=Math.min(r,a),l=Math.max(l,a),n=Math.min(n,h),s=Math.max(s,h));let a=[];for(let h=n;h<=s;h++){let t=[];for(let n=r;n<=l;n++)t.push(e[h][n]);a.push(t)}return a}replaceValueIn2Darray(e,t,r){for(let l=0;l<e.length;l++)for(let n=0;n<e[l].length;n++)e[l][n]==t&&(e[l][n]=r)}}class t{constructor(t){this.sharedService=new e,this.initialPattern=t,this.nbIteration=0}getAllPiecesCombinations(e){let t=e.map((e=>this.sharedService.cropMatrix(e.data))),r=[];return t.forEach((e=>{let t=[];t.push(e),t.push(this.sharedService.reverse2DArray(e));let l=this.sharedService.cloneNDArray(e);for(let r=0;r<3;r++)l=this.sharedService.rotate2DArray(l),t.push(l),t.push(this.sharedService.reverse2DArray(l));r.push(this.removeDuplicateArrays(t))})),r}removeDuplicateArrays(e){const t=[];for(const r of e){let e=!1;for(const l of t)if(this.sharedService.areArraysEqual(r,l)){e=!0;break}e||t.push(r)}return t}parsePattern(e){for(let t=0;t<e.length;t++)for(let r=0;r<e[0].length;r++)-1!=e[t][r]&&(e[t][r]=0)}solve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.nbIteration=0;let l=this.getAllPiecesCombinations(e);return l=l.sort((()=>Math.random()>.5?1:-1)),t?this.parsePattern(t):t=this.sharedService.cloneNDArray(this.initialPattern),t=this.process(t,l,1,r),t}process(e,t,r,l){if(this.nbIteration++,l&&(0==t.length?l(e,!0):this.nbIteration%100==0&&l(e)),0==t.length)return e;const n=t[0];for(let s=0;s<n.length;s++){const a=n[s];for(let n=0;n<e.length;n++)for(let s=0;s<e[0].length;s++)if(this.isPiecePlacable(a,n,s,e)){let h=this.sharedService.cloneNDArray(e);this.placePiece(a,n,s,h,r);let o=this.sharedService.cloneNDArray(t);if(o.shift(),!this.isWrongAreaExist(h,o)){let e=this.process(h,o,r+1,l);if(e)return e}}}return null}placePiece(e,t,r,l){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;for(let s=0;s<e.length;s++)for(let a=0;a<e[0].length;a++)e[s][a]&&0==l[t+s][r+a]&&(l[t+s][r+a]=n)}isPiecePlacable(e,t,r,l){if(t+e.length>=l.length||r+e[0].length>=l[0].length)return!1;for(let n=0;n<e.length;n++)for(let s=0;s<e[0].length;s++)if(e[n][s]&&0!=l[t+n][r+s])return!1;return!0}isWrongAreaExist(e,t){let r=this.sharedService.getCropAreas(e);for(let l=0;l<r.length;l++){const e=r[l];if(e.count%5!=0)return!0;if(5==e.count){let r=!1;for(let l=0;l<t.length;l++){const n=t[l];for(let t=0;t<n.length;t++){const l=n[t];if(e.area.length==l.length&&e.area[0].length==l[0].length){let t=!0;for(let r=0;r<l.length;r++)for(let n=0;n<l[0].length;n++)e.area[r][n]>=100&&!l[r][n]&&(t=!1);if(t){r=!0;break}}}if(r)break}if(!r)return!0}}return!1}}onmessage=e=>{const{pattern:r,pieceList:l}=e.data;new t(r).solve(l,r,(function(e){postMessage({result:e,status:arguments.length>1&&void 0!==arguments[1]&&arguments[1]})}))||postMessage({result:null,status:!0})}})();
//# sourceMappingURL=811.631b5a36.chunk.js.map